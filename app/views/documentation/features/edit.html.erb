<div class="frame">
  <div class="head">
    <div class="actions">
      <h2>Actions</h2>
    </div>
    <h1><%= @feature.info.title %> - <i><%= @feature.relative_path %></i></h1>
  </div>
  <div class="content two_columns">
    <div class="left">
      <div id="raw-bespin" class="bespin"><%= @feature.raw -%></div>
    </div>

    <div class="right">
      <ul class="actions">
        <li>
          <%= link_to_function "Save", "document.getElementById('raw').value= document.getElementById('raw-bespin').bespin.value; document.edit_form.submit();" %>
        </li>
        <li><%= link_to "Back", documentation_features_path %></li>
      </ul>
      <h3>Navigatior</h3>
      <ul class="navigator_list">
        <li>
          <h5><%= link_to_function 'I can edit permissions', 'scrollTo(15);' %></h5>

          <p>@2 @_todo @mc</p>
          <span class="marker m_magenta" style="position:absolute; top: 13px; right: 5px;">3</span>
        </li>
        <li>
          <h5>I can edit permissions</h5>

          <p>@2 @_todo @mc</p>
          <span class="marker m_magenta" style="position:absolute; top: 13px; right: 5px;">7</span>
        </li>
        <li>
          <h5>I can edit permissions</h5>

          <p>@2 @_todo @mc</p>
          <span class="marker m_magenta" style="position:absolute; top: 13px; right: 5px;">8</span>
        </li>
        <li>
          <h5>I can edit permissions</h5>

          <p>@2 @_todo @mc</p>
          <span class="marker m_magenta" style="position:absolute; top: 13px; right: 5px;">1</span>
        </li>
      </ul>
    </div>

    <div class="clb"></div>


  </div>
</div>

<% form_tag documentation_feature_path(@feature.id), :name => 'edit_form' do %>
    <%= hidden_field_tag 'raw', '' %>
<% end %>


<script>
    $(document).ready(function() {
        var bespin = document.getElementById('raw-bespin').bespin;
        bespin.setSetting('tabstop', 2);
        navigationRedraw();

        bespin.editor.textChange.add(function(oldRange, newRange, newText) {
            navigationRedraw();
        });

    });

    function bespin()
    {
        return(document.getElementById('raw-bespin').bespin);
    }

    function editorLines()
    {
        return(bespin().value.split("\n"));
    }

    function navigationElement(line_number, title)
    {
        return("<li><h5><a onclick=\"scrollTo(" + line_number + ");; return false;\" href=\"#\">" + title + "</a></h5>\
       <p>@no_tags_jet</p>\
       <span class=\"marker m_magenta\" style=\"position:absolute; top: 13px; right: 5px;\">0</span> </li>");
    }

    function navigationRedraw()
    {
        var scenario_line = /Scenario:/
        var scenario_title = /[^(Scenario:\s)].*/
        var navigation = ""
        $.each(editorLines(), function(index, line)
        {
            if (scenario_line.test(line))
            {
                navigation += navigationElement(index + 1, scenario_title.exec(line));
            }
        });
        $('.navigator_list').html(navigation);
    }

    function scrollTo(number)
    {
        bespin().setLineNumber(number);
    }

</script>